<!-- templates/includes/opcion_select_recursiva.html -->

<option value="{{ cat.id }}" 
    {# LÃ³gica para marcar como seleccionado #}
    {% if selection_mode == 'single' %}
        {# Para el filtro del buscador (comparaciÃ³n simple de strings/ids) #}
        {% if current_selected|stringformat:"s" == cat.id|stringformat:"s" %}selected{% endif %}
    {% else %}
        {# Para el modal de ediciÃ³n (verifica si la categorÃ­a estÃ¡ en la lista del producto) #}
        {% if cat in current_selected %}selected{% endif %}
    {% endif %}
    >
    
    {# Generar indentaciÃ³n visual basada en el nivel #}
    {% if level == 0 %}ðŸ“ {% endif %}
    {% for i in "x"|rjust:level %}&nbsp;&nbsp;&nbsp;{% endfor %}
    {% if level > 0 %}â†³ {% endif %}
    {{ cat.nombre }}
</option>

{# Llamada recursiva a los hijos #}
{% for hijo in cat.subcategorias.all %}
    {% include "includes/opcion_select_recursiva.html" with cat=hijo level=level|add:"1" selection_mode=selection_mode current_selected=current_selected %}
{% endfor %}