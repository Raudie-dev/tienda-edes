{% extends 'base.html' %}

{% block title %}Panel de Pruebas{% endblock %}

{% block extra_head %}
<style>
    /* Dark panel overrides for this page */
    body {
        background-color: #000 !important;
        color: #fff !important;
    }
    .content-area, .container-fluid {
        background: transparent;
        color: #fff !important;
    }
    .content-area .form-control,
    .content-area .form-select,
    textarea {
        background-color: #111 !important;
        color: #fff !important;
        border: 1px solid #333 !important;
    }
    .content-area .form-control::placeholder { color: #bbb !important; }
    .table, .table th, .table td { color: #fff !important; border-color: rgba(255,255,255,0.05) !important; }
    .text-muted { color: rgba(255,255,255,0.6) !important; }
</style>
{% endblock %}
{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">Gestión de Productos</h1>
    </div>

        <div class="row mb-4 align-items-center">
                <div class="col-md-6">
                        <h5>Registrar</h5>
                        <p class="text-muted">Usa los botones para abrir los modales y registrar productos o categorías.</p>
                </div>
                <div class="col-md-6 text-md-end">
                        <!-- Buttons to open modals -->
                        <button type="button" class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#modalCrearCategoria">
                                <i class="fas fa-plus-circle"></i> Nueva categoría
                        </button>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCrearProducto">
                                <i class="fas fa-box-open"></i> Nuevo producto
                        </button>
                </div>
        </div>

        <!-- Modales -->
        <!-- Modal: Crear categoría -->
        <div class="modal fade" id="modalCrearCategoria" tabindex="-1" aria-labelledby="modalCrearCategoriaLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content bg-dark text-white">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalCrearCategoriaLabel">Crear categoría</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form method="post">
                        {% csrf_token %}
                        <div class="modal-body">
                            <div class="mb-3">
                                <label for="categoria_nombre_modal" class="form-label">Nombre</label>
                                <input id="categoria_nombre_modal" type="text" name="categoria_nombre" class="form-control bg-dark text-white" placeholder="Nombre categoría" required>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" name="crear_categoria" class="btn btn-primary">Crear</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal: Crear producto -->
        <div class="modal fade" id="modalCrearProducto" tabindex="-1" aria-labelledby="modalCrearProductoLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content bg-dark text-white">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalCrearProductoLabel">Crear producto</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="modal-body">
                            <div class="row g-2">
                                <div class="col-md-6">
                                    <label class="form-label">Nombre</label>
                                    <input type="text" name="nombre" class="form-control bg-dark text-white" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Precio</label>
                                    <input type="number" step="0.01" name="precio" class="form-control bg-dark text-white" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Categorías</label>
                                    <!-- Reemplazado: select múltiple -> lista con checkboxes -->
                                    <div class="list-group categorias-list bg-dark text-white" style="max-height:200px; overflow:auto;">
                                        {% for cat in categorias %}
                                            <label class="list-group-item list-group-item-action bg-dark text-white d-flex justify-content-between align-items-center">
                                                <span>{{ cat.nombre }}</span>
                                                <input class="form-check-input ms-2" type="checkbox" name="categoria_ids" value="{{ cat.id }}">
                                            </label>
                                        {% empty %}
                                            <div class="list-group-item bg-dark text-white">No hay categorías</div>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Descripción</label>
                                    <textarea name="descripcion" class="form-control bg-dark text-white" rows="3"></textarea>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Imagen</label>
                                    <input type="file" name="imagen" accept="image/*" class="form-control bg-dark text-white">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" name="crear_producto" class="btn btn-primary">Registrar producto</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    <h3 class="mt-4">Categorías</h3>
    <table class="table table-sm table-dark">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for cat in categorias %}
            <tr>
                <td>{{ cat.nombre }}</td>
                <td>
                    <form method="post" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" name="eliminar_categoria" value="{{ cat.id }}" class="btn btn-outline-danger btn-sm">Eliminar</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="2" class="text-center">No hay categorías.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// filepath: /home/juan/Documentos/Proyectos/tienda-edes/app2/templates/registro.html
// Hacer cada item clicable y sincronizar clase .active con el checkbox
(function(){
    document.addEventListener('DOMContentLoaded', function(){
        document.querySelectorAll('.categorias-list .list-group-item').forEach(function(item){
            var cb = item.querySelector('input[type="checkbox"]');
            if(!cb) return;
            // Inicializar estado visual
            if(cb.checked) item.classList.add('active');

            // Al clicar en el label (todo el item)
            item.addEventListener('click', function(e){
                // Si el click vino desde el checkbox, dejar que cambie por defecto
                if(e.target === cb) {
                    item.classList.toggle('active', cb.checked);
                    return;
                }
                // Si clicamos en cualquier otra parte del item, alternar el checkbox
                cb.checked = !cb.checked;
                item.classList.toggle('active', cb.checked);
            });
        });
    });
})();
</script>
{% endblock %}